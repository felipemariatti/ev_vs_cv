<script>
  // === LINKS DAS PLANILHAS ===
  const PERFIS_LINK = "https://api.allorigins.win/raw?url=" +
    encodeURIComponent("https://docs.google.com/spreadsheets/d/e/2PACX-1vTieSyzAPyQ1TQ_IfwWX3tjBfEkGFgROxgcg9RMsspK9OBIDxZSjyE1I6XW12fIDJqIlqxYpaDzJ4pS/pub?gid=1368562155&single=true&output=csv");

  const CUSTOS_LINK = "https://api.allorigins.win/raw?url=" +
    encodeURIComponent("https://docs.google.com/spreadsheets/d/e/2PACX-1vTieSyzAPyQ1TQ_IfwWX3tjBfEkGFgROxgcg9RMsspK9OBIDxZSjyE1I6XW12fIDJqIlqxYpaDzJ4pS/pub?gid=1420517667&single=true&output=csv");

  // === URL DIRETA DO SEU GOOGLE APPS SCRIPT ===
  // Substitua este link pelo SEU que termina com /exec
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyBH19Cg3xzJf1WhYC9xePhzdMIkbmELpjO3ZyZQ9xjRzJv8Rr9ZELORnZvlKBIE1z1hQ/exec
";

  // === ENVIO DOS DADOS AO CLICAR EM CALCULAR ===
  async function calcular() {
    const custos = {
      ID_temp: 1,
      Gasolina_temp: +document.getElementById("gasolina").value || 0,
      Tarifa_Res_temp: +document.getElementById("tarifaRes").value || 0,
      Tarifa_Pub_temp: +document.getElementById("tarifaPub").value || 0,
      Periodo_temp: +document.getElementById("periodo").value || 5,
      TMA_temp: +document.getElementById("tma").value || 10,
    };

    document.getElementById("detalhamento").innerHTML = `
      <strong>Valores enviados:</strong><br>
      Gasolina: <b>${custos.Gasolina_temp}</b> | Tarifa Res: <b>${custos.Tarifa_Res_temp}</b> | Tarifa Pub: <b>${custos.Tarifa_Pub_temp}</b><br>
      Período: <b>${custos.Periodo_temp}</b> | TMA: <b>${custos.TMA_temp}%</b>
    `;

    try {
      const resp = await fetch(SCRIPT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(custos)
      });
      const json = await resp.json();
      if (json.success) {
        document.getElementById("status").textContent = "✅ Dados gravados na aba CALCULOS.";
      } else {
        document.getElementById("status").textContent = "⚠️ Erro ao gravar: " + (json.error || "");
      }
    } catch (err) {
      document.getElementById("status").textContent = "❌ Erro de rede ou CORS.";
      console.error(err);
    }
  }
</script>
