<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard EV vs ICE</title>

    <style>
        /* ===========================
           Vars de tema (cores/gradientes)
           =========================== */
        :root{
            --grad-bg: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            --grad-btn: linear-gradient(135deg,#10b981 0%,#059669 100%);
            --borda: rgba(255,255,255,0.25);
        }

        /* Reset b√°sico */
        *{margin:0;padding:0;box-sizing:border-box}

        /* ===========================
           Layout base
           =========================== */
        body{
            font-family:"Segoe UI",Tahoma,sans-serif;
            background:var(--grad-bg);
            color:#fff;
            padding:12px 24px;
            overflow:hidden; /* evita scroll */
        }

        /* Cabe√ßalho */
        .header{
            background:rgba(255,255,255,0.2);
            border-radius:10px;
            padding:10px 18px;
            margin-bottom:10px;
            display:flex;justify-content:space-between;align-items:center;
            box-shadow:0 3px 10px rgba(0,0,0,0.2);
        }
        .header h1{font-size:1.2rem}

        /* Grid principal (duas colunas, duas linhas) */
        .dashboard{
            display:grid;
            grid-template-columns:1fr 1fr;
            grid-template-rows:auto auto;
            gap:10px;
            width:940px; /* mant√©m propor√ß√£o atual */
        }

        /* Cart√µes (containers) */
        .card{
            background:rgba(255,255,255,0.15);
            border:1px solid var(--borda);
            border-radius:12px;
            padding:10px;
            backdrop-filter:blur(6px);
            box-shadow:0 3px 8px rgba(0,0,0,0.15);
        }
        .card h3{
            font-size:.9rem;
            border-bottom:1.5px solid rgba(255,255,255,0.3);
            padding-bottom:3px;margin-bottom:6px;
        }

        /* Form inputs */
        label{font-size:.75rem;font-weight:600;color:#fff}
        input,select{
            width:100%;padding:5px 7px;border-radius:8px;
            border:1.5px solid rgba(255,255,255,0.5);
            background:rgba(255,255,255,0.4);
            color:#111;font-size:.85rem;
        }

        /* Imagem do ve√≠culo */
        .vehicle-img{
            width:100%;height:120px;object-fit:contain;
            border-radius:8px;background:#fff;margin:6px 0;
        }

        /* Cards de info do ve√≠culo (grade) */
        .vehicle-info{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(100px,1fr));
            gap:6px;min-height:90px;
        }
        .v-card{
            background:rgba(255,255,255,0.5);
            border-radius:8px;text-align:center;
            padding:6px;color:#111;font-size:.7rem;
            height:70px;display:flex;flex-direction:column;justify-content:center;
        }
        .v-card img{width:20px;height:20px;margin:0 auto 2px;display:block}
        .v-card .emoji{display:block;font-size:1.1rem}
        .v-card .value{font-weight:bold}

        /* ===========================
           Perfis (bot√µes estilo ‚Äúpill‚Äù)
           =========================== */
        .profile-grid{
            display:grid;grid-template-columns:1fr 1fr;gap:6px;
        }
        .profile-pill{
            background:rgba(255,255,255,0.4);
            border:1.5px solid rgba(255,255,255,0.5);
            border-radius:10px;padding:8px 10px;
            display:flex;align-items:center;gap:10px;
            color:#111;cursor:pointer;transition:.25s;
        }
        .profile-pill:hover{background:rgba(255,255,255,0.65)}
        .profile-pill.active{background:var(--grad-btn);color:#fff;border:none}
        .profile-pill .emoji{font-size:2rem;flex-shrink:0;margin-right:6px}
        .profile-info{display:flex;flex-direction:column;line-height:1.2}
        .profile-info .name{font-weight:700;font-size:.85rem}
        .profile-info .details{font-size:.7rem;opacity:.9}

        /* ===========================
           Cen√°rios + inputs num√©ricos
           =========================== */
        .scenario-row{display:flex;gap:6px;margin-bottom:6px}
        .scenario-btn{
            flex:1;border-radius:8px;padding:5px 6px;
            border:1.5px solid rgba(255,255,255,0.5);
            background:rgba(255,255,255,0.4);
            font-weight:700;font-size:.75rem;color:#111;
            cursor:pointer;transition:.25s;
            display:flex;justify-content:center;align-items:center;gap:5px;
        }
        .scenario-btn.active{background:var(--grad-btn);color:#fff;border:none}

        .inputs-grid{
            display:grid;grid-template-columns:repeat(3,1fr);
            gap:6px;margin-bottom:4px;
        }
        .inputs-grid-2{
            display:grid;grid-template-columns:1fr 1fr;
            gap:6px;margin-bottom:4px;
        }

        /* Bot√£o calcular (placeholder, sem c√°lculos ainda) */
        .btn-calc{
            width:100%;background:var(--grad-btn);
            color:#fff;border:none;border-radius:8px;
            font-weight:700;padding:8px;cursor:pointer;
        }
    </style>
</head>
<body>
<!-- Cabe√ßalho -->
<div class="header">
    <h1>‚ö° An√°lise Econ√¥mica: EV vs ICE</h1>
    <span style="font-size:.8rem;opacity:.8">Vers√£o Final</span>
</div>

<!-- Grid principal -->
<div class="dashboard">
    <!-- Coluna 1: EV -->
    <div class="card" id="cardEV">
        <h3>‚ö° Ve√≠culo El√©trico</h3>
        <label>Modelo:</label>
        <select id="selEV"><option>Selecione um modelo</option></select>
        <label>üí∞ Pre√ßo (R$):</label>
        <input id="precoEV" readonly>
        <img id="imgEV" class="vehicle-img" src="https://i.imgur.com/MLNARfh.png" alt="EV">
        <div id="infoEV" class="vehicle-info">
            <div class="v-card"><span class="emoji">üìÖ</span>Ano<br><span class="value">‚Äî</span></div>
            <div class="v-card"><span class="emoji">‚ö°</span>Consumo<br><span class="value">‚Äî</span></div>
            <div class="v-card"><span class="emoji">üõ†Ô∏è</span>Manuten√ß√£o<br><span class="value">‚Äî</span></div>
            <div class="v-card"><span class="emoji">üßæ</span>Seguro<br><span class="value">‚Äî</span></div>
            <div class="v-card"><span class="emoji">üí∞</span>IPVA<br><span class="value">‚Äî</span></div>
            <div class="v-card"><img src="https://i.imgur.com/kQOANzQ.png" alt="Pneu">Pneus<br><span class="value">‚Äî</span></div>
            <div class="v-card"><span class="emoji">üíµ</span>Residual<br><span class="value">‚Äî</span></div>
        </div>
    </div>

    <!-- Coluna 2: ICE -->
    <div class="card" id="cardICE">
        <h3>üöó Ve√≠culo Combust√£o</h3>
        <label>Modelo:</label>
        <select id="selICE"><option>Selecione um modelo</option></select>
        <label>üí∞ Pre√ßo (R$):</label>
        <input id="precoICE" readonly>
        <img id="imgICE" class="vehicle-img" src="https://i.imgur.com/MLNARfh.png" alt="ICE">
        <div id="infoICE" class="vehicle-info">
            <div class="v-card"><span class="emoji">üìÖ</span>Ano<br><span class="value">‚Äî</span></div>
            <div class="v-card"><span class="emoji">‚õΩ</span>Consumo<br><span class="value">‚Äî</span></div>
            <div class="v-card"><span class="emoji">üõ†Ô∏è</span>Manuten√ß√£o<br><span class="value">‚Äî</span></div>
            <div class="v-card"><span class="emoji">üßæ</span>Seguro<br><span class="value">‚Äî</span></div>
            <div class="v-card"><span class="emoji">üí∞</span>IPVA<br><span class="value">‚Äî</span></div>
            <div class="v-card"><img src="https://i.imgur.com/kQOANzQ.png" alt="Pneu">Pneus<br><span class="value">‚Äî</span></div>
            <div class="v-card"><span class="emoji">üíµ</span>Residual<br><span class="value">‚Äî</span></div>
        </div>
    </div>

    <!-- Linha 2: Perfis (abaixo do EV, mesma coluna) -->
    <div class="card" style="grid-column:1/2">
        <h3>üë§ Perfil</h3>
        <div id="perfisContainer" class="profile-grid">Carregando...</div>
    </div>

    <!-- Linha 2: Cen√°rios (abaixo do EV, mesma coluna) -->
    <div class="card" style="grid-column:1/2">
        <h3>üéØ Cen√°rio</h3>
        <div id="cenariosContainer" class="scenario-row"></div>
        <div class="inputs-grid">
            <div><label>Tarifa Res. (R$/kWh):</label><input id="tarifaRes"></div>
            <div><label>Tarifa P√∫b. (R$/kWh):</label><input id="tarifaPub"></div>
            <div><label>Gasolina (R$/L):</label><input id="precoGas"></div>
        </div>
        <div class="inputs-grid-2">
            <div><label>Per√≠odo (anos):</label><input id="anos" type="number"></div>
            <div><label>TMA (%):</label><input id="tma"></div>
        </div>
        <button class="btn-calc">üöÄ CALCULAR</button>
    </div>
</div>

<script>
    /* ===========================
       Constantes (URLs planilhas)
       =========================== */
    const URLS={
        VEICULOS:"https://docs.google.com/spreadsheets/d/e/2PACX-1vSUihOaIXPK9JWb5tXTp3YB0ALT-YIwVdZEeUtMa_CY8chVqzBayBQpnxQTkqLhvPwLVNgddsmZXGAo/pub?gid=0&single=true&output=csv",
        PERFIS:"https://docs.google.com/spreadsheets/d/e/2PACX-1vSUihOaIXPK9JWb5tXTp3YB0ALT-YIwVdZEeUtMa_CY8chVqzBayBQpnxQTkqLhvPwLVNgddsmZXGAo/pub?gid=155387580&single=true&output=csv",
        CENARIOS:"https://docs.google.com/spreadsheets/d/e/2PACX-1vSUihOaIXPK9JWb5tXTp3YB0ALT-YIwVdZEeUtMa_CY8chVqzBayBQpnxQTkqLhvPwLVNgddsmZXGAo/pub?gid=1970963524&single=true&output=csv"
    };

    /* ===========================
       Utilit√°rios num√©ricos BR
       =========================== */
    const toNumBR  = v => parseFloat(String(v).replace(/\./g,"").replace(",",".").trim())||0; // "1.234,56" -> 1234.56
    const fromNumBR= n => Number(n).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}); // 1234.56 -> "1.234,56"

    /* ===========================
       Fetch CSV do Google Sheets
       =========================== */
    async function getCSV(url){
        const res=await fetch(url);
        const text=await res.text();
        // Split seguro por v√≠rgulas fora de aspas
        const rows=text.trim().split(/\r?\n/).map(line=>
            line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c=>c.replace(/^"|"$/g,""))
        );
        const headers=rows.shift();
        return rows.map(row=>{
            const obj={};
            headers.forEach((h,i)=>obj[h.trim()]=row[i]?.trim?.()||"");
            return obj;
        });
    }

    /* ===========================
       Reset visual do bloco ve√≠culo
       =========================== */
    function resetVehicle(precoEl,imgEl,infoEl){
        precoEl.value="";
        imgEl.src="https://i.imgur.com/MLNARfh.png";
        infoEl.querySelectorAll(".value").forEach(v=>v.textContent="‚Äî");
    }

    /* ===========================
       Render de informa√ß√µes do ve√≠culo
       =========================== */
    function renderInfo(v,precoEl,imgEl,infoEl,unit){
        if(!v) return;
        precoEl.value = fromNumBR(toNumBR(v.preco_inicial));
        imgEl.src     = v.imagem || "https://i.imgur.com/MLNARfh.png";
        const residual= v["residual_%"] ? (toNumBR(v["residual_%"])*100).toFixed(0)+"%" : "‚Äî";

        // Atualiza cada card por label
        infoEl.querySelectorAll(".v-card").forEach(c=>{
            const label=c.textContent.trim();
            const val=c.querySelector(".value");
            if(label.includes("Ano"))         val.textContent = v.ano || "‚Äî";
            else if(label.includes("Consumo"))val.textContent = v.consumo ? `${fromNumBR(v.consumo)} ${unit}` : "‚Äî";
            else if(label.includes("Manuten√ß√£o"))val.textContent = v.manutencao_anual ? `R$ ${fromNumBR(v.manutencao_anual)}` : "‚Äî";
            else if(label.includes("Seguro")) val.textContent = v.seguro_anual ? `R$ ${fromNumBR(v.seguro_anual)}` : "‚Äî";
            else if(label.includes("IPVA"))   val.textContent = v.ipva_anual ? `R$ ${fromNumBR(v.ipva_anual)}` : "‚Äî";
            else if(label.includes("Pneus"))  val.textContent = v.pneus_ano ? `R$ ${fromNumBR(v.pneus_ano)}` : "‚Äî";
            else if(label.includes("Residual"))val.textContent= residual;
        });
    }

    /* ===========================
       Inicializa√ß√£o (carrega tudo)
       =========================== */
    (async function init(){
        try{
            // Busca paralela das 3 abas
            const [veiculos,perfis,cenarios]=await Promise.all([
                getCSV(URLS.VEICULOS),
                getCSV(URLS.PERFIS),
                getCSV(URLS.CENARIOS)
            ]);

            // Cache de elementos
            const $ = id => document.getElementById(id);
            const selEV=$("selEV"), selICE=$("selICE");
            const infoEV=$("infoEV"), infoICE=$("infoICE");
            const imgEV=$("imgEV"), imgICE=$("imgICE");
            const precoEV=$("precoEV"), precoICE=$("precoICE");

            // Separa por tipo
            const evs  = veiculos.filter(v => (v.tipo||"").toUpperCase()==="EV");
            const ices = veiculos.filter(v => (v.tipo||"").toUpperCase()==="ICE");

            // Popula selects de modelos
            for(const v of evs){ const o=document.createElement("option"); o.value=v.modelo; o.textContent=v.modelo; selEV.appendChild(o); }
            for(const v of ices){ const o=document.createElement("option"); o.value=v.modelo; o.textContent=v.modelo; selICE.appendChild(o); }

            // Handlers de mudan√ßa (EV/ICE)
            selEV.onchange=()=>{
                const v=veiculos.find(x=>x.modelo===selEV.value);
                if(!v||selEV.value.includes("Selecione")) return resetVehicle(precoEV,imgEV,infoEV);
                renderInfo(v,precoEV,imgEV,infoEV,"km/kWh");
            };
            selICE.onchange=()=>{
                const v=veiculos.find(x=>x.modelo===selICE.value);
                if(!v||selICE.value.includes("Selecione")) return resetVehicle(precoICE,imgICE,infoICE);
                renderInfo(v,precoICE,imgICE,infoICE,"km/L");
            };

            // ===== Perfis (emoji grande √† esquerda) =====
            const perfDiv=$("perfisContainer");
            perfDiv.innerHTML="";
            perfis.forEach((p,i)=>{
                const key=(p.perfil||"").toLowerCase();
                const icon= key.includes("app") ? "üì±" : key.includes("pes") ? "üöô" : key.includes("via") ? "üõ£Ô∏è" : "üè†";

                const el=document.createElement("div");
                el.className="profile-pill"+(i===0?" active":"");
                el.innerHTML=`
        <span class="emoji">${icon}</span>
        <div class="profile-info">
          <div class="name">${p.perfil}</div>
          <div class="details">${fromNumBR(toNumBR(p.km_ano))} km/ano</div>
          <div class="details">Recarga P√∫blica: ${(toNumBR(p["%_recarga_publica"])*100).toFixed(0)}%</div>
        </div>
      `;
                el.onclick=()=>{
                    document.querySelectorAll(".profile-pill").forEach(b=>b.classList.remove("active"));
                    el.classList.add("active");
                };
                perfDiv.appendChild(el);
            });

            // ===== Cen√°rios (seleciona Base por padr√£o) =====
            const cenDiv=$("cenariosContainer");
            cenDiv.innerHTML="";
            cenarios.forEach(c=>{
                const name=(c.cenario||"").toLowerCase();
                const icon= name.includes("otimista") ? "üìà" : name.includes("pessimista") ? "üìâ" : "üìä";

                const btn=document.createElement("button");
                btn.className="scenario-btn";
                btn.innerHTML=`${icon} ${c.cenario}`;
                btn.onclick=()=>{
                    document.querySelectorAll(".scenario-btn").forEach(b=>b.classList.remove("active"));
                    btn.classList.add("active");
                    // Preenche inputs do cen√°rio (permite sobrescrita manual depois)
                    $("tarifaRes").value=fromNumBR(toNumBR(c.tarifa_residencial_kwh));
                    $("tarifaPub").value=fromNumBR(toNumBR(c.tarifa_publica_kwh));
                    $("precoGas").value=fromNumBR(toNumBR(c.preco_gasolina_l));
                };
                cenDiv.appendChild(btn);
            });

            // Ativa ‚ÄúBase‚Äù automaticamente
            const baseBtn=[...cenDiv.children].find(b=>b.textContent.includes("Base"));
            if(baseBtn){
                baseBtn.classList.add("active");
                const base=cenarios.find(c=>(c.cenario||"").toLowerCase().includes("base"));
                if(base){
                    $("tarifaRes").value=fromNumBR(toNumBR(base.tarifa_residencial_kwh));
                    $("tarifaPub").value=fromNumBR(toNumBR(base.tarifa_publica_kwh));
                    $("precoGas").value=fromNumBR(toNumBR(base.preco_gasolina_l));
                }
            }
        }catch(err){
            alert("Erro ao carregar dados: "+err);
            console.error(err);
        }
    })();
</script>
</body>
</html>
